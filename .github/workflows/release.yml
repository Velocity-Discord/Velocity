name: Release
on:
    push:
        branches:
            - "main"

jobs:
    dist:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Install Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: 16

            - uses: pnpm/action-setup@v2
              name: Install pnpm
              id: pnpm-install
              with:
                  version: 6.24.3
                  run_install: true

            - name: Build Files
              run: pnpm build

            - name: Package Asar
              run: pnpm bundle

            - uses: "marvinpinto/action-automatic-releases@latest"
              if: "contains(github.event.head_commit.message, '[Release]')"
              with:
                  repo_token: "${{ secrets.GITHUB_TOKEN }}"
                  automatic_release_tag: "${{ github.event.head_commit.message }} | sed 's/[Release] v//'"
                  prerelease: false
                  title: "Velocity Automatic Release"
                  files: |
                      dist/velocity.asar
