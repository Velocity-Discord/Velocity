"use strict";var e=require("electron"),n=require("module"),a=require("path"),t=require("fs"),r=require("electron-devtools-installer");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=s(e),i=s(n),l=s(a),d=s(t),c=s(r);d.default.existsSync(a.join(__dirname,"../../data"))||d.default.mkdirSync(a.join(__dirname,"../../data")),d.default.existsSync(a.join(__dirname,"../../data/config.json"))||d.default.writeFileSync(a.join(__dirname,"../../data/config.json"),JSON.stringify({}));const p=JSON.parse(d.default.readFileSync(a.join(__dirname,"../../data/config.json"),"utf8"));class u extends o.default.BrowserWindow{constructor(e){if(!e||!e.webPreferences||!e.webPreferences.preload||process.argv.includes("--vanilla"))return super(e);const n=e.webPreferences.preload;return process.env.DISCORD_PRELOAD=n,e={...e,webPreferences:{...e.webPreferences,preload:e.title&&e.webPreferences&&e.webPreferences.nativeWindowOpen?a.join(__dirname,"preload.js"):a.join(__dirname,"preloadSplash.js"),nodeIntegration:!0,devTools:!0},transparent:!!p.Transparency,vibrancy:p.Vibrancy?"hud":void 0,backgroundColor:"#00000000",visualEffectState:"active"},new o.default.BrowserWindow(e)}}var f="velocity:handle-kill";process.env.VELOCITY_DIRECTORY=l.default.join(__dirname,"../../"),o.default.app.commandLine.appendSwitch("no-force-async-hooks-checks"),o.default.app.on("ready",(()=>{c.default(r.REACT_DEVELOPER_TOOLS),o.default.session.defaultSession.webRequest.onHeadersReceived((function({responseHeaders:e},n){for(const n of Object.keys(e))n.includes("content-security-policy")&&delete e[n];n({cancel:!1,responseHeaders:e})})),e.ipcMain.handle(f,(()=>{o.default.dialog.showMessageBox({type:"warning",title:"Process Exited",message:"The Discord process has been killed."}),process.exit(1)}))}));const _=require.resolve("electron");delete require.cache[_]?.exports,require.cache[_].exports={...o.default,BrowserWindow:u};const g="DANGEROUS_ENABLE_DEVTOOLS_ONLY_ENABLE_IF_YOU_KNOW_WHAT_YOURE_DOING";global.appSettings||(global.appSettings={}),global.appSettings?.settings||(global.appSettings.settings={});const S=global.appSettings.settings;global.appSettings.settings=new Proxy(S,{get:(e,n)=>n===g||e[n],set:(e,n,a)=>(n===g||(e[n]=a),!0)}),function(){const e=l.default.join(process.resourcesPath,"app.asar"),n=JSON.parse(d.default.readFileSync(l.default.join(e,"package.json"),"utf8"));o.default.app.setAppPath(e),o.default.app.name=n.name,i.default._load(l.default.join(e,n.main),null,!0)}();
